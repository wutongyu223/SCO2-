# plot_ts_diagram函数

`plot_ts_diagram`是[[calautatlion.m代码结构]]中的核心可视化函数，用于绘制超临界CO2再热布雷顿循环的温熵(T-S)图，直观展示循环各状态点和热力过程。

## 函数定义

```matlab
function plot_ts_diagram(T1, T2, T3, T4, T5, T6, T7, T8, T9, T10, T11, T12, T13, T14, T15, T16, T17,...
                         S1, S2, S3, S4, S5, S6, S7, S8, S9, S10, S11, S12, S13, S14, S15, S16, S17,...
                         P1, P2, P3, P4, P5, P6, P7, P8, P9, P10, P11, P12, P13, P14, P15, P16, P17,...
                         alpha, W_net, eta)
```

## 输入参数

函数接收所有状态点的温度、熵、压力值及系统参数作为输入：

- **T1-T17**: 各状态点温度 [K]
- **S1-S17**: 各状态点熵值 [J/(kg·K)]
- **P1-P17**: 各状态点压力 [MPa]
- **alpha**: 分流比
- **W_net**: 净输出功率 [J/kg]
- **eta**: 循环热效率

## 函数结构

### 1. 初始化图形界面
```matlab
% 创建一个新图
figure;
hold on;

% 设置标题和标签
title('超临界CO₂布雷顿循环T-S图');
xlabel('熵 s [J/(kg·K)]');
ylabel('温度 T [K]');
```
- 使用[[figure函数]]创建新图形窗口
- 使用[[hold函数]]保持图形状态，便于后续添加内容
- 设置图形标题和坐标轴标签

### 2. 绘制主循环路径
```matlab
% 主循环连线
% 高压透平 (1→2)
line1 = plot([S1,S2], [T1,T2], 'b-', 'LineWidth', 1.5);

% 再热器 (2→3) - 等压加热
line2 = plot([S2,S3], [T2,T3], 'r-', 'LineWidth', 1.5);

% 低压透平 (3→4)
line3 = plot([S3,S4], [T3,T4], 'b-', 'LineWidth', 1.5);

% 高温回热器热侧 (4→5) - 等压放热
line4 = plot([S4,S5], [T4,T5], 'b-', 'LineWidth', 1.5);

...

% 加热器 (16→17/1) - 等压吸热
line14 = plot([S16,S17], [T16,T17], 'r-', 'LineWidth', 1.5);
```
- 使用[[plot函数]]绘制循环各段路径
- 蓝色线条表示一般过程，红色线条表示吸热过程
- 线宽1.5使图形清晰易读

### 3. 绘制分流部分
```matlab
% 分流部分（虚线）
% 分流点到副压缩机入口 (6→12) - 连线
line15 = plot([S6,S12], [T6,T12], 'b--', 'LineWidth', 1.5);

% 副压缩机 (12→13)
line16 = plot([S12,S13], [T12,T13], 'b--', 'LineWidth', 1.5);

% 副压缩机出口到合流点 (13→14) - 连线
line17 = plot([S13,S14], [T13,T14], 'b--', 'LineWidth', 1.5);
```
- 使用虚线表示分流部分路径
- 保持与主循环相同的颜色方案

### 4. 标记状态点
```matlab
% 标记主循环状态点
main_points = [1,2,3,4,5,6,7,8,9,10,11,14,15,16,17];
main_T = [T1,T2,T3,T4,T5,T6,T7,T8,T9,T10,T11,T14,T15,T16,T17];
main_S = [S1,S2,S3,S4,S5,S6,S7,S8,S9,S10,S11,S14,S15,S16,S17];

for i = 1:length(main_points)
    plot(main_S(i), main_T(i), 'ro', 'MarkerSize', 6, 'MarkerFaceColor', 'r');
    text(main_S(i), main_T(i), [' ', num2str(main_points(i))], 'FontSize', 8);
end

% 标记分流部分的状态点（12和13）
plot(S12, T12, 'bo', 'MarkerSize', 6, 'MarkerFaceColor', 'b');
text(S12, T12, ' 12', 'FontSize', 8);
plot(S13, T13, 'bo', 'MarkerSize', 6, 'MarkerFaceColor', 'b');
text(S13, T13, ' 13', 'FontSize', 8);
```
- 使用红色圆点标记主循环状态点
- 使用蓝色圆点标记分流部分状态点
- 使用[[text函数]]添加状态点编号

### 5. 添加图例和性能数据
```matlab
% 添加图例
legend([line1, line2, line16, plot(NaN,NaN,'ro','MarkerFaceColor','r'), plot(NaN,NaN,'bo','MarkerFaceColor','b')], ...
       {'主循环路径', '吸热过程', '分流路径', '主循环状态点', '分流状态点'}, ...
       'Location', 'Best', 'FontSize', 8);

% 设置图形属性
grid on;
set(gca, 'FontSize', 12);
set(gcf, 'Position', [100, 100, 800, 600]);

% 添加说明文本
text(min(main_S)+0.05*(max(main_S)-min(main_S)), max(main_T)*0.9, ...
    {['循环热效率: ', num2str(eta*100, '%.2f'), ' %'], ...
     ['净输出功率: ', num2str(W_net/1000, '%.2f'), ' kJ/kg']}, ...
     'FontSize', 10, 'BackgroundColor', [1 1 1 0.7]);
```
- 使用[[legend函数]]添加图例
- 使用[[grid函数]]添加网格线
- 使用`set`函数调整图形尺寸和字体
- 在图上添加循环性能数据

## 状态点与热力过程

T-S图中的主要状态点及过程如下：

| 点号 | 设备位置 | 类型 |
|------|----------|------|
| 1 | 高压透平入口 | 高温高压 |
| 2 | 高压透平出口/再热器入口 | 中温中压 |
| 3 | 再热器出口/低压透平入口 | 高温中压 |
| 4 | 低压透平出口 | 中温低压 |
| 5 | 高温回热器热侧出口 | 中温低压 |
| 6 | 低温回热器热侧出口/分流点 | 低温低压 |
| 7-8 | 冷却器入口/出口 | 低温低压 |
| 9 | 主压缩机a出口 | 低温中压 |
| 10 | 中间冷却器出口 | 低温中压 |
| 11 | 主压缩机b出口 | 低温高压 |
| 12 | 副压缩机入口 | 低温低压 |
| 13 | 副压缩机出口 | 低温高压 |
| 14 | 合流点/低温回热器冷侧入口 | 低温高压 |
| 15 | 低温回热器冷侧出口 | 中温高压 |
| 16 | 高温回热器冷侧出口 | 中温高压 |
| 17 | 加热器出口 | 高温高压 |

主要热力过程：

| 过程 | 设备 | 性质 | 颜色 |
|------|------|------|------|
| 1→2 | 高压透平 | 膨胀做功 | 蓝色实线 |
| 2→3 | 再热器 | 等压吸热 | 红色实线 |
| 3→4 | 低压透平 | 膨胀做功 | 蓝色实线 |
| 4→5 | 高温回热器热侧 | 等压放热 | 蓝色实线 |
| 5→6 | 低温回热器热侧 | 等压放热 | 蓝色实线 |
| 7→8 | 冷却器 | 等压放热 | 蓝色实线 |
| 8→9 | 主压缩机a | 压缩耗功 | 蓝色实线 |
| 9→10 | 中间冷却器 | 等压放热 | 蓝色实线 |
| 10→11 | 主压缩机b | 压缩耗功 | 蓝色实线 |
| 12→13 | 副压缩机 | 压缩耗功 | 蓝色虚线 |
| 14→15 | 低温回热器冷侧 | 等压吸热 | 红色实线 |
| 15→16 | 高温回热器冷侧 | 等压吸热 | 红色实线 |
| 16→17 | 加热器 | 等压吸热 | 红色实线 |

## 分析与解读

### 1. 温度熵图的物理意义
T-S图中，区域面积表示热量传递。图中一个循环所包围的面积表示净做功。

### 2. 热效率优化
通过观察T-S图可以分析：
- 减小高低温端的温差可提高效率
- 增加再热可提高平均吸热温度
- 优化分流比可减少不可逆损失

### 3. 增强可视化效果
函数通过以下方式增强图形可读性：
- 使用不同颜色区分吸热过程和其他过程
- 使用实线/虚线区分主循环和分流部分
- 使用标记和编号明确标识状态点
- 直接在图上标注关键性能数据

## 使用技巧

### 1. 自动调整图形比例
```matlab
axis tight; % 紧凑显示
% 或手动设置范围
xlim([min(main_S)-50, max(main_S)+50]);
ylim([min(main_T)-20, max(main_T)+20]);
```

### 2. 增加等压线或等温线
```matlab
% 绘制几条等压线作为参考
for p = [7.5, 15, 21]
    s_range = linspace(min(main_S), max(main_S), 100);
    t_vals = zeros(size(s_range));
    for i = 1:length(s_range)
        try
            t_vals(i) = refpropm('t', 'p', p*1000, 's', s_range(i), 'CO2');
        catch
            t_vals(i) = NaN;
        end
    end
    plot(s_range, t_vals, 'k:', 'LineWidth', 0.5);
    text(s_range(end), t_vals(end), [num2str(p), ' MPa'], 'FontSize', 7);
end
```

### 3. 交互式图形
添加数据光标使用户可交互查看具体点的数据：
```matlab
dcm = datacursormode(gcf);
dcm.Enable = 'on';
```

## 与其他函数的关联
- [[plot函数]] - 基础绘图功能
- [[figure函数]] - 创建图形窗口
- [[hold函数]] - 保持图形状态
- [[legend函数]] - 添加图例
- [[text函数]] - 添加文本标注
- [[grid函数]] - 添加网格线
- [[num2str函数]] - 数值转字符串 