# 函数关联图

本文档描述了超临界CO2布雷顿循环代码中主要函数之间的调用关系和数据流。

## 核心代码文件关系

```
+----------------+      +----------------+      +----------------+
| delete2.m      |      | cost2.m        |      | calautatlion.m |
| 简单循环计算    |<-----| 多目标优化      |      | 再热循环计算    |
| 固定参数        |      | NSGA-III算法   |      | T-S图绘制      |
+----------------+      +----------------+      +----------------+
       ^                       ^                      ^
       |                       |                      |
       |                       |                      |
       +-----------------------------------------------+
                              |
                      共同使用的核心函数
```

## 核心函数调用路径

### 1. 热力学计算路径

```
refpropm函数
    |
    +----> 透平计算 (所有文件)
    |       |
    |       +----> 等熵效率修正 (所有文件)
    |
    +----> 压缩机计算 (所有文件)
    |       |
    |       +----> 等熵效率修正 (所有文件)
    |
    +----> 回热器迭代计算
            |
            +----> while循环 (所有文件)
                    |
                    +----> 热平衡方程求解
```

### 2. 优化计算路径

```
platemo函数 (cost2.m)
    |
    +----> NSGAIII算法
            |
            +----> efficiency_objective函数
            |       |
            |       +----> calculate_cycle函数
            |               |
            |               +----> refpropm函数
            |               |
            |               +----> while循环
            |
            +----> cost_objective函数
                    |
                    +----> calculate_cycle函数
```

### 3. 可视化路径

```
plot_ts_diagram函数 (calautatlion.m)
    |
    +----> figure函数
    |
    +----> hold on函数
    |
    +----> plot函数 (17条线段)
    |
    +----> text函数 (17个状态点标注)
    |
    +----> legend函数
```

## 数据流图

以下展示了主要计算过程中的数据流向：

```
输入参数 -----> 透平计算 -----> H1,S1,T1
                   |
                   v
              压缩机计算 -----> H6,S6,T6 / H10,S10,T10
                   |
                   v
while循环热平衡计算 <-----> 回热器计算
                   |
                   v
              性能计算 -----> n (效率)
                   |
                   v
              成本计算 -----> CHTR, CLTR (回热器成本)
                   |
                   v
              结果输出 -----> disp函数
                   |
                   v
                T-S图 -----> plot函数
```

## 函数依赖矩阵

下表展示了主要函数之间的依赖关系，"X"表示行中的函数依赖于列中的函数：

| 函数 | refpropm | while循环 | try-catch | plot | disp | calculate_cycle | platemo |
|------|----------|-----------|-----------|------|------|-----------------|---------|
| delete2.m | X | X | - | - | X | - | - |
| cost2.m | X | X | X | X | X | X | X |
| calautatlion.m | X | X | - | X | X | - | - |
| calculate_cycle | X | X | X | - | - | - | - |
| efficiency_objective | - | - | X | - | - | X | - |
| cost_objective | - | - | X | - | - | X | - |
| plot_ts_diagram | - | - | - | X | - | - | - |

## 数据依赖关系

### 主要状态点数据流

- **点1**: 透平出口
  - 由 refpropm 根据等熵效率计算
  - 影响 主压缩机入口条件, 回热器热平衡计算

- **点6/点10**: 压缩机出口
  - 由 refpropm 根据等熵效率计算
  - 影响 回热器入口条件, 热平衡计算

- **点11**: 高温回热器冷侧入口
  - 通过 while循环 迭代计算
  - 是热平衡求解的关键变量

### 性能与成本计算数据流

1. 热效率计算
   ```
   透平做功 - 压缩机耗功
   --------------------- = 热效率 n
        输入热量
   ```

2. 回热器成本计算
   ```
   UA值 = 热量 / 温差
   成本 = a * (UA)^b
   ```

## 错误处理流

```
try
  |
  +----> 计算过程
  |       |
  |       +----> 物理合理性检查1
  |       |       |
  |       |       +----> return (如果不合理)
  |       |
  |       +----> while循环
  |       |       |
  |       |       +----> try
  |       |       |       |
  |       |       |       +----> 迭代计算
  |       |       |       |
  |       |       |       +----> return (如果出错)
  |       |       |
  |       |       +----> 收敛检查
  |       |
  |       +----> 物理合理性检查2
  |               |
  |               +----> return (如果不合理)
  |
  +----> catch
          |
          +----> return 默认值
```

## 相关函数笔记
- [[refpropm函数]] - 热力学性质计算的核心
- [[while循环]] - 迭代求解的关键
- [[try-catch结构]] - 错误处理机制
- [[calculate_cycle函数]] - 优化计算的核心
- [[plot_ts_diagram函数]] - T-S图绘制函数 