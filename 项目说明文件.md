
《超临界 CO₂ 布雷顿循环系统模拟与优化程序说明文档》  
Super‑critical CO₂ Brayton Cycle – Simulation & Optimization **Program Manual**

---

## 目录 Contents  

1. **项目概述 (Project Overview)**  
2. **系统结构与状态点 (System Layout & State‑Point Map)**  
3. **全局参数与参考态 (Global Parameters & Reference State)**  
4. **程序模块总览 (Module Map)**  
5. **核心模块详解 (Core‑Module Specifications)**  
   1. `main.m` – 主控  
   2. `calculate_cycle.m` – 循环计算  
   3. `exergy_analysis.m` – 火用分析  
   4. `economic_analysis.m` – 经济评价  
   5. `optimize_cycle.m` – 优化框架  
   6. `plot_results.m` – 可视化 / T‑s 图  
   7. `sensitivity_analysis.m` – 敏感性分析  
6. **关键环节容错与约束**  
   - 回热器 (Recuperator)  
   - 副压缩机 & 合流段 (Split‑Flow Compressor & Mixer)  
7. **火用分析注意事项 (Exergy Accounting Caveats)**  
8. **T‑s 图绘制保障 (Robust T‑s Plotting)**  
9. **通用注意事项 (General Coding Guidelines)**  
10. **开发计划与环境要求 (Dev Plan & Environment)**  
11. **单元测试与里程碑 (Unit‑Test & Milestones)**  

---

## 1. 项目概述 (Project Overview)

本项目旨在构建**再热 + 分流再压缩（主压缩机中间冷却）+ 双透平**超临界 CO₂ 布雷顿循环 (Reheat + RC + Inter‑cooling + Dual‑Turbine sCO₂ Brayton)。  
目标：  
- **稳态热力计算**：预测效率、净功、各组件热负荷。  
- **火用 & 经济分析**：定量评估损失与成本。  
- **多目标优化**：热效率最大化 & 比成本最小化。  
- **高鲁棒性**：在数值/物性异常时自动降级或报警。  

---

## 2. 系统结构与状态点

### 2.1 组件列表  
| # | 组件 Component | 说明 / Notes |
|---|---------------|-------------|
| HP‑Turbine | 高压透平 | η≈0.93 |
| Reheater | 再热器 | 定压 |
| LP‑Turbine | 低压透平 | η≈0.93 |
| RHX‑HT / RHX‑LT | 高/低温回热器 | ε≈0.86 |
| Splitter / Mixer | 分流 / 合流 | α∈[0.2, 0.5] |
| MC‑a / MC‑b | 主压缩机两级 | η≈0.89 |
| RC | 副压缩机 | η≈0.89 |
| IHX | 中间冷却器 | 定压冷却 |
| Cooler | 冷却器 |至最低 T≈305 K |
| Heater | 加热器 | T_max≈840 K |

### 2.2 状态点编号  

```
1  – HP‑Turbine inlet
2  – HP‑Turbine exit / Reheater in
3  – Reheater out / LP‑Turbine in
...
16 – RHX‑HT cold‑side exit / Heater in
17 – Heater out (≡1)
```

> **Tips**：在代码中以 `state(1).T`、`state(1).P` … 存储，便于结构化访问。

---

## 3. 全局参数与参考态

```matlab
REF.T0 = 298.15;   % K
REF.P0 = 101.325;  % kPa
REF.h0 = refpropm('h','T',REF.T0,'P',REF.P0/1e3,'CO2');
REF.s0 = refpropm('s','T',REF.T0,'P',REF.P0/1e3,'CO2');
OPT.var_bounds = struct( ...
    'P_reheat',   [10, 20]*1e6, ...   % Pa
    'P_intercool',[10, 20]*1e6, ...
    'alpha',      [0.2, 0.5], ...
    'dT_RHX_HT',  [5, 30], ...        % K
    'dT_RHX_LT',  [5, 30]);
```

---

## 4. 程序模块总览

| 模块 | 功能摘要 | 关键 I/O | 核心算法 | 约束 / 异常 | 建议精度 |
|------|----------|----------|----------|-------------|----------|
| `main.m` | 全局参数设定、调用各功能、输出报告 | 无→结构体 `Result` | 调度 | try‑catch 全局捕捉 | — |
| `calculate_cycle.m` | 17 状态点 & 性能 | `para`→`state`,`perf` | 混合迭代 + 松弛 | 能量 & 质量平衡；REFPROP 降级 | Δh/h < 1e‑6 |
| `exergy_analysis.m` | 组件火用损失 | `state`,`perf`→`exergy` | 控制体火用方程 | Exergy balance residual < 0.5 % |  |
| `economic_analysis.m` | CAPEX/OPEX | `state`,`size`→`cost` | Bare‑module, Lang | 参数缺失→经验因子 | — |
| `optimize_cycle.m` | 多目标寻优 | `bounds`→Pareto | NSGA‑II / MOGA | Penalty 函数 | 代数 ≤ 200 |
| `plot_results.m` | T‑s & 敏感图 | `state`,`pareto` | 插值&Matlab plot | 座标范围检查 | — |
| `sensitivity_analysis.m` | 单因子 or Sobol | `para_set`→`Δη` | Morris/Sobol | 采样失败 fallback LHS | — |

---

## 5. 核心模块详解

### 5.1 `main.m`

```matlab
function Result = main()
try
   init_env();                       % 路径 & REFPROP 校验
   para0 = default_para();           % 初始猜测
   [state, perf] = calculate_cycle(para0);
   ex  = exergy_analysis(state, perf);
   eco = economic_analysis(state, perf);
   pareto = optimize_cycle();
   plot_results(state, pareto);
   sensitivity_analysis(para0);
   Result = pack_results(state, perf, ex, eco, pareto);
catch ME
   log_error(ME);
   rethrow(ME);
end
end
```

- **异常策略**：  
  1. 若 `refpropm` 抛出 *PSFLSH 249* 等 → 调用 `safe_prop()` 降级为等温焓或插值表。  
  2. 迭代超限 → 自动减小松弛 `λ = max(0.2, λ/2)` 并重跑。  

### 5.2 `calculate_cycle.m`

1. **输入**：`para` (结构体，含 P/T/α/dT…)  
2. **流程**  
   1. **热端迭代**（回热器双向耦合）：求解 `f = h6 - h15 = 0`  
   2. **压缩机链**：按 `η_is` 计算，`h_out = h_in + (h_iso- h_in)/η`；使用 `clamp(h_out, h_min, h_max)`  
   3. **能量平衡**：`W_turb – W_comp – Q_cool = W_net`  
3. **数值**  
   - 牛顿−拉夫森 + Linesearch，`max_iter = 80`, `tol = 1e‑6`  
   - 对 ill‑condition → 切换 Broyden  

### 5.3 `exergy_analysis.m`

- **参考态**：见 §3  
- **火用流**  
  ```math
  Ex = (h - h₀) - T₀(s - s₀) + v(P - P₀)
  ```
- **遗漏检查**  
  - 摩擦压降 → `ΔP·ṁ/ρ` 转化为流动火用损失  
  - 阀门、旁通 → 等焓假设  

### 5.4 `economic_analysis.m`

- **设备基准成本**：Turton correlation  
- **规模修正**：`C = C_ref·(Size/Size_ref)^0.6`  
- **折现**：NPV @ 8 % over 20 y  

### 5.5 `optimize_cycle.m`

```matlab
opts = optimoptions('gamultiobj',...
   'PopulationSize',200,...
   'MaxGenerations',200,...
   'UseParallel',true);
[x,fval] = gamultiobj(@obj_fun, n_var, [],[],[],[], lb, ub, @nonlcon, opts);
```

> **可互换算法**：MOGA、BASIN‑HOPPING+Surrogate、CMA‑ES。选择时考虑计算预算。

---

## 6. 关键环节容错与约束

### 6.1 回热器 (RHX‑HT / RHX‑LT)

| 步骤 | 约束 / 容错 |
|------|-------------|
| 初猜 `T6_guess = T4 – 0.5·dT_HT` | 保证 `T_hot_in > T_cold_out + dT_min` |
| 物性调用前检查 | `300 K < T < 1200 K`, `5 MPa < P < 35 MPa` |
| 热负荷限幅 | `Q ≤ 1.1·Q_design`，超限 → dT 阀值+2 K |
| 收敛准则 | `|Q_hot - Q_cold| / Q_hot < 1e‑4` |
| REFPROP 错误 | `try` PHFLSH → `catch` → switch TPFLSH；再失败→线性插值 |
| 松弛 | `T_new = T_old + λ·ΔT`, `λ∈[0.3,0.8]` |
| max_iter | 40，超限报警并返回 `status=1` |

### 6.2 副压缩机 & 合流段

| 变量 | 限幅 |
|------|-----|
| 分流比例 `α` | `[0.2, 0.5]` |
| 等熵出口焓 `h_is` | clamp 至 `[h_in, h_in+1e5] J/kg` |
| 实际 `h_out` | 计算后再 `clamp`，防负值 |
| 合流点焓 | `h14 = (1-α)·h11 + α·h13s`；若 `|h_mix - h14| > 3 kJ/kg` → 重新分配 |
| 压缩机功 `W_RC` | `≤1.2·W_design`，超限→降低 `α` 并回补 |

---

## 7. 火用分析注意事项

1. **统一参考态**：(`T₀`, `P₀`, `h₀`, `s₀`) 全局常量。  
2. **Exergy 组成**：物理 + 化学 (CO₂ 单组分 → 忽略化学) + 动能 + 位能（可选）。  
3. **全局平衡**：  
   ```math
   ∑Ex_in - ∑Ex_out - ∑Ex_destroy = 0
   residual ≤ 0.5 %
   ```  
4. **漏算检查**：管道压降、阀门节流、辅助泵/风扇。  

---

## 8. T‑s 图绘制保障

| 要点 | 实现 |
|------|------|
| 连线顺序 | `1→2→3→4→5→…→17` |
| 过程细分 | 透平 (等熵→等压放热) 50 点插值；压缩机反向同理 |
| `T(s)` 反解 | Newton；若非单调 → 分段 spline |
| 输出 | `plot(...,'LineWidth',1.2)`，`print -dpng -r600 'Ts_cycle.png'` |
| 关键点标注 | `text(s(i),T(i),num2str(i))` |
| 抗锯齿 | `set(gcf,'Renderer','painters')` |

---

## 9. 通用注意事项

* **单位**：全部 SI；温度 K，压力 Pa (或 MPa *仅显示*)。  
* **函数注释**：`%> @param P [Pa]`，兼容 *MATLAB* **help** 生成。  
* **变量命名**：`T_hp_in, m_dot_RC`，避免单字符。  
* **异常框架**：模块内部 `try-catch` → 抛出 `MException` → 顶层记录 `log_error()`.  
* **并行计算**：`parpool` 自动 size，`parfor` 于优化 & 敏感性。  
* **性能提示**：缓存 `refpropm` 结果 (Memoization)；向量化循环。  
* **环境**：  
  - **REFPROP 10+**，已配置系统变量 `RPPREFIX`.  
  - **MATLAB 2024a**，Toolboxes: *Global Optimization*, *Parallel Computing*.  

---

## 10. 开发计划与环境要求

| 周 | 任务 | 交付物 |
|----|------|--------|
| 1 | 环境搭建、`refpropm` 封装 | `safe_prop.m` |
| 2 | 基础循环 `calculate_cycle` & 单元测试 | `cycle_demo.mlx` |
| 3 | 火用 & 经济模块 | 对比文献验证表 |
| 4 | T‑s 可视化、美化 | `Ts_example.png` |
| 5 | 优化框架 & 并行加速 | 初步 Pareto |
| 6 | 敏感性分析、鲁棒性测试 | 报告 v0.9 |
| 7 | 文档完善、代码重构 | 本说明文档 v1.0 |
| 8 | 终验收 & 交付 | Release‑tag |

**验收标准**：  
- 基准工况效率误差 ≤ ±1 % *vs* 文献。  
- 全局火用残差 ≤ 0.5 % 输入。  
- 50 次随机参数模拟无崩溃。  
- 优化收敛至稳定前沿 (Spread ≤ 0.02, Hyper‑volume ≥ 0.8 × best)。  

---

## 11. 单元测试与示例

1. **Property‑Patch Test**：`safe_prop` 对 `T=[280:5:1100] K`、`P=[7.5:0.5:30] MPa` 全面扫描 — 无异常。  
2. **Energy‑Balance Test**：`calculate_cycle(default_para)` → `|ΔQ/ Q_in|<1e‑4`.  
3. **Exergy‑Balance Test**：残差打印。  
4. **Optimizer Smoke Test**：`optimize_cycle('maxGen',10)` ≤ 5 min 完成。  

示例脚本：`run_demo.m`

```matlab
para = default_para();
[state, perf] = calculate_cycle(para);
disp(perf.eta_th);
plot_results(state);
```

