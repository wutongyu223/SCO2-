%% 超临界CO₂布雷顿循环T-S图绘制
% 此程序绘制超临界CO₂布雷顿循环的T-S图，使用预设参数

%% 初始化参数 - 各状态点的温度、熵和压力
% 状态点1-17的温度 [K]
T = zeros(17, 1);
T(1) = 873;   % 高压透平入口
T(2) = 800;   % 高压透平出口/再热器入口
T(3) = 873;   % 再热器出口/低压透平入口
T(4) = 710;   % 低压透平出口
T(5) = 600;   % 高温回热器热侧出口
T(6) = 450;   % 低温回热器热侧出口/分流点
T(7) = 450;   % 分流点到主路冷却器
T(8) = 305;   % 冷却器出口/主压缩机a入口
T(9) = 370;   % 主压缩机a出口/中间冷却入口
T(10) = 305;  % 中间冷却出口/主压缩机b入口
T(11) = 380;  % 主压缩机b出口
T(12) = 450;  % 副压缩机入口
T(13) = 490;  % 副压缩机出口
T(14) = 410;  % 合流点
T(15) = 520;  % 低温回热器冷侧出口
T(16) = 690;  % 高温回热器冷侧出口
T(17) = 873;  % 加热器出口/高压透平入口

% 状态点1-17的熵 [J/(kg·K)]
S = zeros(17, 1);
S(1) = 2800;  % 高压透平入口
S(2) = 2850;  % 高压透平出口/再热器入口
S(3) = 2950;  % 再热器出口/低压透平入口
S(4) = 3050;  % 低压透平出口
S(5) = 2950;  % 高温回热器热侧出口
S(6) = 2850;  % 低温回热器热侧出口/分流点
S(7) = 2850;  % 分流点到主路冷却器
S(8) = 2550;  % 冷却器出口/主压缩机a入口
S(9) = 2570;  % 主压缩机a出口/中间冷却入口
S(10) = 2480; % 中间冷却出口/主压缩机b入口
S(11) = 2500; % 主压缩机b出口
S(12) = 2850; % 副压缩机入口
S(13) = 2880; % 副压缩机出口
S(14) = 2600; % 合流点
S(15) = 2700; % 低温回热器冷侧出口
S(16) = 2750; % 高温回热器冷侧出口
S(17) = 2800; % 加热器出口/高压透平入口

% 状态点1-17的压力 [MPa]
P = zeros(17, 1);
P(1) = 21;    % 高压透平入口
P(2) = 15;    % 高压透平出口/再热器入口
P(3) = 15;    % 再热器出口/低压透平入口
P(4) = 7.57;  % 低压透平出口
P(5) = 7.57;  % 高温回热器热侧出口
P(6) = 7.57;  % 低温回热器热侧出口/分流点
P(7) = 7.57;  % 分流点到主路冷却器
P(8) = 7.57;  % 冷却器出口/主压缩机a入口
P(9) = 12;    % 主压缩机a出口/中间冷却入口
P(10) = 12;   % 中间冷却出口/主压缩机b入口
P(11) = 21;   % 主压缩机b出口
P(12) = 7.57; % 副压缩机入口
P(13) = 21;   % 副压缩机出口
P(14) = 21;   % 合流点
P(15) = 21;   % 低温回热器冷侧出口
P(16) = 21;   % 高温回热器冷侧出口
P(17) = 21;   % 加热器出口/高压透平入口

% 其他参数
alpha = 0.3333; % 分流比例
eta = 0.52;     % 循环热效率
W_net = 500;    % 净输出功率 [kJ/kg]

%% 绘制T-S图
% 创建图形
figure;
hold on;

% 设置标题和标签
title('超临界CO₂布雷顿循环T-S图', 'FontSize', 14);
xlabel('熵 s [J/(kg·K)]', 'FontSize', 12);
ylabel('温度 T [K]', 'FontSize', 12);

% 绘制主循环连线
% 高压透平 (1→2)
line1 = plot([S(1),S(2)], [T(1),T(2)], 'b-', 'LineWidth', 1.5);

% 再热器 (2→3) - 等压加热
line2 = plot([S(2),S(3)], [T(2),T(3)], 'r-', 'LineWidth', 1.5);

% 低压透平 (3→4)
plot([S(3),S(4)], [T(3),T(4)], 'b-', 'LineWidth', 1.5);

% 高温回热器热侧 (4→5) - 等压放热
plot([S(4),S(5)], [T(4),T(5)], 'b-', 'LineWidth', 1.5);

% 低温回热器热侧 (5→6) - 等压放热
plot([S(5),S(6)], [T(5),T(6)], 'b-', 'LineWidth', 1.5);

% 冷却器 (7→8) - 等压放热
plot([S(7),S(8)], [T(7),T(8)], 'b-', 'LineWidth', 1.5);

% 主压缩机a (8→9)
plot([S(8),S(9)], [T(8),T(9)], 'b-', 'LineWidth', 1.5);

% 中间冷却器 (9→10) - 等压放热
plot([S(9),S(10)], [T(9),T(10)], 'b-', 'LineWidth', 1.5);

% 主压缩机b (10→11)
plot([S(10),S(11)], [T(10),T(11)], 'b-', 'LineWidth', 1.5);

% 低温回热器冷侧 (14→15) - 等压吸热
plot([S(14),S(15)], [T(14),T(15)], 'r-', 'LineWidth', 1.5);

% 高温回热器冷侧 (15→16) - 等压吸热
plot([S(15),S(16)], [T(15),T(16)], 'r-', 'LineWidth', 1.5);

% 加热器 (16→17/1) - 等压吸热
plot([S(16),S(17)], [T(16),T(17)], 'r-', 'LineWidth', 1.5);

% 分流部分（虚线）
% 副压缩机 (12→13)
line16 = plot([S(12),S(13)], [T(12),T(13)], 'b--', 'LineWidth', 1.5);

% 副压缩机出口到合流点 (13→14) - 连线
plot([S(13),S(14)], [T(13),T(14)], 'b--', 'LineWidth', 1.5);

% 主压缩机出口到合流点 (11→14) - 连线
plot([S(11),S(14)], [T(11),T(14)], 'b-', 'LineWidth', 1.5);

% 标记状态点
for i = 1:17
    if i == 12 || i == 13  % 分流部分的点
        plot(S(i), T(i), 'bo', 'MarkerSize', 6, 'MarkerFaceColor', 'b');
        text(S(i), T(i), [' ', num2str(i)], 'FontSize', 8);
    else  % 主循环的点
        plot(S(i), T(i), 'ro', 'MarkerSize', 6, 'MarkerFaceColor', 'r');
        text(S(i), T(i), [' ', num2str(i)], 'FontSize', 8);
    end
end

% 添加图例
legend([line1, line2, line16, plot(NaN,NaN,'ro','MarkerFaceColor','r'), plot(NaN,NaN,'bo','MarkerFaceColor','b')], ...
       {'主循环路径', '吸热过程', '分流路径', '主循环状态点', '分流状态点'}, ...
       'Location', 'Best', 'FontSize', 8);

% 添加CO₂临界点标记（假设临界点）
Tc = 304.13;  % CO₂临界温度 [K]
Pc = 7.38;    % CO₂临界压力 [MPa]
plot(2500, Tc, 'k*', 'MarkerSize', 10);
text(2500, Tc, ' 临界点', 'FontSize', 8);

% 添加等压线示意（可选）
% 这里简化处理，实际应根据CO₂物性计算

% 设置图形属性
grid on;
set(gca, 'FontSize', 12);
set(gcf, 'Position', [100, 100, 800, 600]);

% 添加说明文本
text(min(S)+0.05*(max(S)-min(S)), max(T)*0.9, ...
    {['循环热效率: ', num2str(eta*100, '%.2f'), ' %'], ...
     ['净输出功率: ', num2str(W_net, '%.2f'), ' kJ/kg'], ...
     ['分流比例: ', num2str(alpha, '%.2f')]}, ...
     'FontSize', 10, 'BackgroundColor', [1 1 1 0.7]);

% 添加标题
title('超临界CO₂布雷顿循环T-S图', 'FontSize', 14);

hold off;

% 在命令窗口输出说明
disp('已绘制超临界CO₂布雷顿循环T-S图');
disp('注意：本图使用预设参数，未进行精确热力学计算');
disp('热力学数据为近似值，仅用于示意'); 